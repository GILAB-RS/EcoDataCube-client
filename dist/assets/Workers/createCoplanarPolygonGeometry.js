define(["./arrayRemoveDuplicates-3a9a9480","./BoundingRectangle-67be6fe0","./Transforms-73e77b72","./Cartesian2-b4b7b0b3","./Check-5e798bbf","./ComponentDatatype-2da3a966","./CoplanarPolygonGeometryLibrary-6d76da75","./when-208fe5b0","./GeometryAttribute-b541caa6","./GeometryAttributes-b0b294d8","./GeometryInstance-411ead1b","./GeometryPipeline-86615bad","./IndexDatatype-3bc916b1","./Math-8386669c","./PolygonGeometryLibrary-9fe00cbc","./PolygonPipeline-b445e3f3","./VertexFormat-7e57a3bd","./RuntimeError-7f634f5d","./WebGLConstants-5e2a49ab","./OrientedBoundingBox-2e9d8f93","./EllipsoidTangentPlane-69cc10ff","./AxisAlignedBoundingBox-122de82b","./IntersectionTests-40db2afa","./Plane-b91bfb59","./AttributeCompression-9711314b","./EncodedCartesian3-21af0f3b","./ArcType-dc1c5aee","./EllipsoidRhumbLine-73a4e3eb"],(function(e,t,a,n,r,o,i,l,s,p,y,c,u,m,d,g,b,h,f,C,v,x,P,A,w,F,G,L){"use strict";var E=new n.Cartesian3,T=new t.BoundingRectangle,D=new n.Cartesian2,_=new n.Cartesian2,k=new n.Cartesian3,V=new n.Cartesian3,R=new n.Cartesian3,I=new n.Cartesian3,M=new n.Cartesian3,B=new n.Cartesian3,H=new a.Quaternion,O=new a.Matrix3,z=new a.Matrix3,S=new n.Cartesian3;function N(e){var t=(e=l.defaultValue(e,l.defaultValue.EMPTY_OBJECT)).polygonHierarchy,a=l.defaultValue(e.vertexFormat,b.VertexFormat.DEFAULT);this._vertexFormat=b.VertexFormat.clone(a),this._polygonHierarchy=t,this._stRotation=l.defaultValue(e.stRotation,0),this._ellipsoid=n.Ellipsoid.clone(l.defaultValue(e.ellipsoid,n.Ellipsoid.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=d.PolygonGeometryLibrary.computeHierarchyPackedLength(t)+b.VertexFormat.packedLength+n.Ellipsoid.packedLength+2}N.fromPositions=function(e){return new N({polygonHierarchy:{positions:(e=l.defaultValue(e,l.defaultValue.EMPTY_OBJECT)).positions},vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid})},N.pack=function(e,t,a){return a=l.defaultValue(a,0),a=d.PolygonGeometryLibrary.packPolygonHierarchy(e._polygonHierarchy,t,a),n.Ellipsoid.pack(e._ellipsoid,t,a),a+=n.Ellipsoid.packedLength,b.VertexFormat.pack(e._vertexFormat,t,a),a+=b.VertexFormat.packedLength,t[a++]=e._stRotation,t[a]=e.packedLength,t};var Q=n.Ellipsoid.clone(n.Ellipsoid.UNIT_SPHERE),j=new b.VertexFormat,U={polygonHierarchy:{}};return N.unpack=function(e,t,a){t=l.defaultValue(t,0);var r=d.PolygonGeometryLibrary.unpackPolygonHierarchy(e,t);t=r.startingIndex,delete r.startingIndex;var o=n.Ellipsoid.unpack(e,t,Q);t+=n.Ellipsoid.packedLength;var i=b.VertexFormat.unpack(e,t,j);t+=b.VertexFormat.packedLength;var s=e[t++];t=e[t];return(a=l.defined(a)?a:new N(U))._polygonHierarchy=r,a._ellipsoid=n.Ellipsoid.clone(o,a._ellipsoid),a._vertexFormat=b.VertexFormat.clone(i,a._vertexFormat),a._stRotation=s,a.packedLength=t,a},N.createGeometry=function(t){var r=t._vertexFormat,l=t._polygonHierarchy,b=t._stRotation,h=l.positions;if(!((h=e.arrayRemoveDuplicates(h,n.Cartesian3.equalsEpsilon,!0)).length<3)){var f=k,C=V,v=R,x=M,P=B;if(i.CoplanarPolygonGeometryLibrary.computeProjectTo2DArguments(h,I,x,P)){f=n.Cartesian3.cross(x,P,f),f=n.Cartesian3.normalize(f,f),n.Cartesian3.equalsEpsilon(I,n.Cartesian3.ZERO,m.CesiumMath.EPSILON6)||(A=t._ellipsoid.geodeticSurfaceNormal(I,S),n.Cartesian3.dot(f,A)<0&&(f=n.Cartesian3.negate(f,f),x=n.Cartesian3.negate(x,x)));var A=i.CoplanarPolygonGeometryLibrary.createProjectPointsTo2DFunction(I,x,P),w=i.CoplanarPolygonGeometryLibrary.createProjectPointTo2DFunction(I,x,P);r.tangent&&(C=n.Cartesian3.clone(x,C)),r.bitangent&&(v=n.Cartesian3.clone(P,v));A=(l=d.PolygonGeometryLibrary.polygonsFromHierarchy(l,A,!1)).hierarchy;var F=l.polygons;if(0!==A.length){h=A[0].outerRing,l=a.BoundingSphere.fromPoints(h);for(var G=d.PolygonGeometryLibrary.computeBoundingRectangle(f,w,h,b,T),L=[],N=0;N<F.length;N++){var Q=new y.GeometryInstance({geometry:function(e,t,r,i,l,y,c,d){var b=e.positions,h=g.PolygonPipeline.triangulate(e.positions2D,e.holes);h.length<3&&(h=[0,1,2]),(e=u.IndexDatatype.createTypedArray(b.length,h.length)).set(h);var f=O;0!==i?(h=a.Quaternion.fromAxisAngle(y,i,H),f=a.Matrix3.fromQuaternion(h,f),(t.tangent||t.bitangent)&&(h=a.Quaternion.fromAxisAngle(y,-i,H),x=a.Matrix3.fromQuaternion(h,z),c=n.Cartesian3.normalize(a.Matrix3.multiplyByVector(x,c,c),c),t.bitangent&&(d=n.Cartesian3.normalize(n.Cartesian3.cross(y,c,d),d)))):f=a.Matrix3.clone(a.Matrix3.IDENTITY,f);var C=_;t.st&&(C.x=r.x,C.y=r.y);for(var v=b.length,x=3*v,P=new Float64Array(x),A=t.normal?new Float32Array(x):void 0,w=t.tangent?new Float32Array(x):void 0,F=t.bitangent?new Float32Array(x):void 0,G=t.st?new Float32Array(2*v):void 0,L=0,T=0,k=0,V=0,R=0,I=0;I<v;I++){var M,B=b[I];P[L++]=B.x,P[L++]=B.y,P[L++]=B.z,t.st&&(M=l(a.Matrix3.multiplyByVector(f,B,E),D),n.Cartesian2.subtract(M,C,M),B=m.CesiumMath.clamp(M.x/r.width,0,1),M=m.CesiumMath.clamp(M.y/r.height,0,1),G[R++]=B,G[R++]=M),t.normal&&(A[T++]=y.x,A[T++]=y.y,A[T++]=y.z),t.tangent&&(w[V++]=c.x,w[V++]=c.y,w[V++]=c.z),t.bitangent&&(F[k++]=d.x,F[k++]=d.y,F[k++]=d.z)}return x=new p.GeometryAttributes,t.position&&(x.position=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:P})),t.normal&&(x.normal=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:A})),t.tangent&&(x.tangent=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:w})),t.bitangent&&(x.bitangent=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:F})),t.st&&(x.st=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:G})),new s.Geometry({attributes:x,indices:e,primitiveType:s.PrimitiveType.TRIANGLES})}(F[N],r,G,b,w,f,C,v)});L.push(Q)}return(A=c.GeometryPipeline.combineInstances(L)[0]).attributes.position.values=new Float64Array(A.attributes.position.values),A.indices=u.IndexDatatype.createTypedArray(A.attributes.position.values.length/3,A.indices),h=A.attributes,r.position||delete h.position,new s.Geometry({attributes:h,indices:A.indices,primitiveType:A.primitiveType,boundingSphere:l})}}}},function(e,t){return l.defined(t)&&(e=N.unpack(e,t)),N.createGeometry(e)}}));