define(["./AttributeCompression-9711314b","./Cartesian2-b4b7b0b3","./Color-a612ab18","./when-208fe5b0","./IndexDatatype-3bc916b1","./Math-8386669c","./OrientedBoundingBox-2e9d8f93","./createTaskProcessorWorker","./Check-5e798bbf","./Transforms-73e77b72","./RuntimeError-7f634f5d","./WebGLConstants-5e2a49ab","./EllipsoidTangentPlane-69cc10ff","./AxisAlignedBoundingBox-122de82b","./IntersectionTests-40db2afa","./Plane-b91bfb59"],(function(e,a,n,r,t,i,o,s,f,d,c,u,h,l,b,g){"use strict";var p=new a.Cartesian3,C=new a.Ellipsoid,y=new a.Rectangle,I={min:void 0,max:void 0,indexBytesPerElement:void 0};var m=new a.Cartesian3,w=new a.Cartesian3,x=new a.Cartesian3,v=new a.Cartesian3,A=new a.Cartesian3,E=new a.Cartographic,N=new a.Rectangle;return s((function(s,f){var d;u=s.packedBuffer,d=new Float64Array(u),u=0,I.indexBytesPerElement=d[u++],I.min=d[u++],I.max=d[u++],a.Cartesian3.unpack(d,3,p),u+=a.Cartesian3.packedLength,a.Ellipsoid.unpack(d,u,C),u+=a.Ellipsoid.packedLength,a.Rectangle.unpack(d,u,y);var c=new(2===I.indexBytesPerElement?Uint16Array:Uint32Array)(s.indices),u=new Uint16Array(s.positions),h=new Uint32Array(s.counts),l=new Uint32Array(s.indexCounts),b=new Uint32Array(s.batchIds),g=new Uint32Array(s.batchTableColors),T=new Array(h.length),k=p,B=C,L=y,O=I.min,U=I.max,P=s.minimumHeights,F=s.maximumHeights;r.defined(P)&&r.defined(F)&&(P=new Float32Array(P),F=new Float32Array(F));var S=u.length/2,R=u.subarray(0,S),D=u.subarray(S,2*S);e.AttributeCompression.zigZagDeltaDecode(R,D);for(var M=new Float64Array(3*S),_=0;_<S;++_){var G=R[_],Y=D[_];G=i.CesiumMath.lerp(L.west,L.east,G/32767),Y=i.CesiumMath.lerp(L.south,L.north,Y/32767),Y=a.Cartographic.fromRadians(G,Y,0,E),Y=B.cartographicToCartesian(Y,m);a.Cartesian3.pack(Y,M,3*_)}var V=h.length,H=new Array(V),W=new Array(V),z=0,Z=0;for(_=0;_<V;++_)H[_]=z,W[_]=Z,z+=h[_],Z+=l[_];var j=new Float32Array(3*S*2),q=new Uint16Array(2*S),J=new Uint32Array(W.length),K=new Uint32Array(l.length),Q=[],X={};for(_=0;_<V;++_)re=g[_],r.defined(X[re])?(X[re].positionLength+=h[_],X[re].indexLength+=l[_],X[re].batchIds.push(_)):X[re]={positionLength:h[_],indexLength:l[_],offset:0,indexOffset:0,batchIds:[_]};var $,ee=0,ae=0;for(re in X)X.hasOwnProperty(re)&&((te=X[re]).offset=ee,te.indexOffset=ae,ee+=2*te.positionLength,ae+=$=2*te.indexLength+6*te.positionLength,te.indexLength=$);var ne=[];for(re in X)X.hasOwnProperty(re)&&(te=X[re],ne.push({color:n.Color.fromRgba(parseInt(re)),offset:te.indexOffset,count:te.indexLength,batchIds:te.batchIds}));for(_=0;_<V;++_){var re,te,ie=(te=X[re=g[_]]).offset,oe=3*ie,se=ie,fe=H[_],de=h[_],ce=b[_],ue=O,he=U;r.defined(P)&&r.defined(F)&&(ue=P[_],he=F[_]);for(var le=Number.POSITIVE_INFINITY,be=Number.NEGATIVE_INFINITY,ge=Number.POSITIVE_INFINITY,pe=Number.NEGATIVE_INFINITY,Ce=0;Ce<de;++Ce){var ye=a.Cartesian3.unpack(M,3*fe+3*Ce,m);B.scaleToGeodeticSurface(ye,ye);var Ie=(we=B.cartesianToCartographic(ye,E)).latitude,me=we.longitude,we=(le=Math.min(Ie,le),be=Math.max(Ie,be),ge=Math.min(me,ge),pe=Math.max(me,pe),B.geodeticSurfaceNormal(ye,w));Ie=a.Cartesian3.multiplyByScalar(we,ue,x),me=a.Cartesian3.add(ye,Ie,v),Ie=a.Cartesian3.multiplyByScalar(we,he,Ie),Ie=a.Cartesian3.add(ye,Ie,A);a.Cartesian3.subtract(Ie,k,Ie),a.Cartesian3.subtract(me,k,me),a.Cartesian3.pack(Ie,j,oe),a.Cartesian3.pack(me,j,oe+3),q[se]=ce,q[se+1]=ce,oe+=6,se+=2}(L=N).west=ge,L.east=pe,L.south=le,L.north=be,T[_]=o.OrientedBoundingBox.fromRectangle(L,O,U,B);var xe=te.indexOffset,ve=W[_],Ae=l[_];for(J[_]=xe,Ce=0;Ce<Ae;Ce+=3){var Ee=c[ve+Ce]-fe,Ne=c[ve+Ce+1]-fe,Te=c[ve+Ce+2]-fe;Q[xe++]=2*Ee+ie,Q[xe++]=2*Ne+ie,Q[xe++]=2*Te+ie,Q[xe++]=2*Te+1+ie,Q[xe++]=2*Ne+1+ie,Q[xe++]=2*Ee+1+ie}for(Ce=0;Ce<de;++Ce){var ke=Ce,Be=(Ce+1)%de;Q[xe++]=2*ke+1+ie,Q[xe++]=2*Be+ie,Q[xe++]=2*ke+ie,Q[xe++]=2*ke+1+ie,Q[xe++]=2*Be+1+ie,Q[xe++]=2*Be+ie}te.offset+=2*de,te.indexOffset=xe,K[_]=xe-J[_]}Q=t.IndexDatatype.createTypedArray(j.length/3,Q);for(var Le=ne.length,Oe=0;Oe<Le;++Oe){for(var Ue=ne[Oe].batchIds,Pe=0,Fe=Ue.length,Se=0;Se<Fe;++Se)Pe+=K[Ue[Se]];ne[Oe].count=Pe}return u=function(e,a,r){var t=a.length,i=2+t*o.OrientedBoundingBox.packedLength+1+function(e){for(var a=e.length,r=0,t=0;t<a;++t)r+=n.Color.packedLength+3+e[t].batchIds.length;return r}(r),s=new Float64Array(i),f=0;s[f++]=e,s[f++]=t;for(var d=0;d<t;++d)o.OrientedBoundingBox.pack(a[d],s,f),f+=o.OrientedBoundingBox.packedLength;var c=r.length;s[f++]=c;for(var u=0;u<c;++u){var h=r[u];n.Color.pack(h.color,s,f),f+=n.Color.packedLength,s[f++]=h.offset,s[f++]=h.count;var l=h.batchIds,b=l.length;s[f++]=b;for(var g=0;g<b;++g)s[f++]=l[g]}return s}(2===Q.BYTES_PER_ELEMENT?t.IndexDatatype.UNSIGNED_SHORT:t.IndexDatatype.UNSIGNED_INT,T,ne),f.push(j.buffer,Q.buffer,J.buffer,K.buffer,q.buffer,u.buffer),{positions:j.buffer,indices:Q.buffer,indexOffsets:J.buffer,indexCounts:K.buffer,batchIds:q.buffer,packedBuffer:u.buffer}}))}));