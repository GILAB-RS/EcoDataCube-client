define(["./AxisAlignedBoundingBox-122de82b","./Cartesian2-b4b7b0b3","./when-208fe5b0","./TerrainEncoding-e1b1da20","./IndexDatatype-3bc916b1","./Math-8386669c","./Transforms-73e77b72","./Check-5e798bbf","./WebMercatorProjection-1b058022","./createTaskProcessorWorker","./AttributeCompression-9711314b","./ComponentDatatype-2da3a966","./WebGLConstants-5e2a49ab","./RuntimeError-7f634f5d"],(function(e,t,r,n,i,o,a,s,d,h,c,u,I,l){"use strict";function g(){s.DeveloperError.throwInstantiationError()}Object.defineProperties(g.prototype,{errorEvent:{get:s.DeveloperError.throwInstantiationError},credit:{get:s.DeveloperError.throwInstantiationError},tilingScheme:{get:s.DeveloperError.throwInstantiationError},ready:{get:s.DeveloperError.throwInstantiationError},readyPromise:{get:s.DeveloperError.throwInstantiationError},hasWaterMask:{get:s.DeveloperError.throwInstantiationError},hasVertexNormals:{get:s.DeveloperError.throwInstantiationError},availability:{get:s.DeveloperError.throwInstantiationError}});var m=[];g.getRegularGridIndices=function(e,t){var n=m[e];r.defined(n)||(m[e]=n=[]);var i=n[t];return r.defined(i)||f(e,t,i=e*t<o.CesiumMath.SIXTY_FOUR_KILOBYTES?n[t]=new Uint16Array((e-1)*(t-1)*6):n[t]=new Uint32Array((e-1)*(t-1)*6),0),i};var T=[];g.getRegularGridIndicesAndEdgeIndices=function(e,t){var n=T[e];r.defined(n)||(T[e]=n=[]);var i,o,a,s,d=n[t];return r.defined(d)||(i=g.getRegularGridIndices(e,t),o=(s=p(e,t)).westIndicesSouthToNorth,a=s.southIndicesEastToWest,e=s.eastIndicesNorthToSouth,s=s.northIndicesWestToEast,d=n[t]={indices:i,westIndicesSouthToNorth:o,southIndicesEastToWest:a,eastIndicesNorthToSouth:e,northIndicesWestToEast:s}),d};var E=[];function p(e,t){for(var r=new Array(t),n=new Array(e),i=new Array(t),o=new Array(e),a=0;a<e;++a)n[o[a]=a]=e*t-1-a;for(a=0;a<t;++a)i[a]=(a+1)*e-1,r[a]=(t-a-1)*e;return{westIndicesSouthToNorth:r,southIndicesEastToWest:n,eastIndicesNorthToSouth:i,northIndicesWestToEast:o}}function f(e,t,r,n){for(var i=0,o=0;o<t-1;++o){for(var a=0;a<e-1;++a){var s=i,d=s+e,h=d+1,c=s+1;r[n++]=s,r[n++]=d,r[n++]=c,r[n++]=c,r[n++]=d,r[n++]=h,++i}++i}}function y(e,t,r,n){for(var i=e[0],o=e.length,a=1;a<o;++a){var s=e[a];r[n++]=i,r[n++]=s,r[n++]=t,r[n++]=t,r[n++]=s,r[n++]=t+1,i=s,++t}return n}g.getRegularGridAndSkirtIndicesAndEdgeIndices=function(e,t){var n=E[e];r.defined(n)||(E[e]=n=[]);var o,a,s,d,h,c,u,I,l=n[t];return r.defined(l)||(s=(o=e*t)+(c=2*e+2*t),I=(a=(e-1)*(t-1)*6)+6*Math.max(0,c-4),d=(u=p(e,t)).westIndicesSouthToNorth,h=u.southIndicesEastToWest,c=u.eastIndicesNorthToSouth,u=u.northIndicesWestToEast,f(e,t,I=i.IndexDatatype.createTypedArray(s,I),0),g.addSkirtIndices(d,h,c,u,o,I,a),l=n[t]={indices:I,westIndicesSouthToNorth:d,southIndicesEastToWest:h,eastIndicesNorthToSouth:c,northIndicesWestToEast:u,indexCountWithoutSkirts:a}),l},g.addSkirtIndices=function(e,t,r,n,i,o,a){a=y(e,i,o,a),a=y(t,i+=e.length,o,a),a=y(r,i+=t.length,o,a),y(n,i+=r.length,o,a)},g.heightmapTerrainQuality=.25,g.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,r){return 2*e.maximumRadius*Math.PI*g.heightmapTerrainQuality/(t*r)},g.prototype.requestTileGeometry=s.DeveloperError.throwInstantiationError,g.prototype.getLevelMaximumGeometricError=s.DeveloperError.throwInstantiationError,g.prototype.getTileDataAvailable=s.DeveloperError.throwInstantiationError,g.prototype.loadTileDataAvailability=s.DeveloperError.throwInstantiationError;var v=new t.Cartesian3,N=new t.Cartesian3,w=new t.Cartesian3,b=new t.Cartographic,S=new t.Cartesian2;function M(e,r,n,i,s,d,h,c,u){var I=Number.POSITIVE_INFINITY,l=s.north,g=s.south,m=s.east,T=s.west;m<T&&(m+=o.CesiumMath.TWO_PI);for(var E=e.length,p=0;p<E;++p){var f=n[y=e[p]],y=i[y];b.longitude=o.CesiumMath.lerp(T,m,y.x),b.latitude=o.CesiumMath.lerp(g,l,y.y),b.height=f-r,f=d.cartographicToCartesian(b,v),a.Matrix4.multiplyByPoint(h,f,f),t.Cartesian3.minimumByComponent(f,c,c),t.Cartesian3.maximumByComponent(f,u,u),I=Math.min(I,b.height)}return I}function x(e,t,n,i,a,s,h,c,u,I,l,g,m,T){var E=r.defined(h),p=u.north,f=u.south,y=u.east,N=u.west;y<N&&(y+=o.CesiumMath.TWO_PI);for(var w=n.length,M=0;M<w;++M){var x=n[M],C=a[x],A=s[x];b.longitude=o.CesiumMath.lerp(N,y,A.x)+m,b.latitude=o.CesiumMath.lerp(f,p,A.y)+T,b.height=C-I;var W,P;C=c.cartographicToCartesian(b,v);E&&(S.x=h[x*=2],S.y=h[1+x]),i.hasWebMercatorT&&(W=(d.WebMercatorProjection.geodeticLatitudeToMercatorAngle(b.latitude)-l)*g),i.hasGeodeticSurfaceNormals&&(P=c.geodeticSurfaceNormal(C)),t=i.encode(e,t,C,A,b.height,S,W,P)}}function C(e,t){var n;return"function"==typeof e.slice&&"function"!=typeof(n=e.slice()).sort&&(n=void 0),(n=r.defined(n)?n:Array.prototype.slice.call(e)).sort(t),n}return h((function(s,h){var c,u,I=(ge=s.quantizedVertices).length/3,l=s.octEncodedNormals,m=s.westIndices.length+s.eastIndices.length+s.southIndices.length+s.northIndices.length,T=s.includeWebMercatorT,E=s.exaggeration,p=s.exaggerationRelativeHeight,f=1!==E,y=t.Rectangle.clone(s.rectangle),A=y.west,W=y.south,P=y.east,D=y.north,k=t.Ellipsoid.clone(s.ellipsoid),F=s.minimumHeight,H=s.maximumHeight,_=s.relativeToCenter,G=a.Transforms.eastNorthUpToFixedFrame(_,k),V=a.Matrix4.inverseTransformation(G,new a.Matrix4);T&&(c=d.WebMercatorProjection.geodeticLatitudeToMercatorAngle(W),u=1/(d.WebMercatorProjection.geodeticLatitudeToMercatorAngle(D)-c));var Y=ge.subarray(0,I),O=ge.subarray(I,2*I),B=ge.subarray(2*I,3*I),R=r.defined(l),L=new Array(I),j=new Array(I),U=new Array(I),z=T?new Array(I):[],q=f?new Array(I):[],Q=N;Q.x=Number.POSITIVE_INFINITY,Q.y=Number.POSITIVE_INFINITY,Q.z=Number.POSITIVE_INFINITY;var K=w;K.x=Number.NEGATIVE_INFINITY,K.y=Number.NEGATIVE_INFINITY,K.z=Number.NEGATIVE_INFINITY;for(var X=Number.POSITIVE_INFINITY,Z=Number.NEGATIVE_INFINITY,J=Number.POSITIVE_INFINITY,$=Number.NEGATIVE_INFINITY,ee=0;ee<I;++ee){var te=Y[ee],re=O[ee],ne=te/32767,ie=re/32767;te=o.CesiumMath.lerp(F,H,B[ee]/32767);b.longitude=o.CesiumMath.lerp(A,P,ne),b.latitude=o.CesiumMath.lerp(W,D,ie),b.height=te,X=Math.min(b.longitude,X),Z=Math.max(b.longitude,Z),J=Math.min(b.latitude,J),$=Math.max(b.latitude,$),re=k.cartographicToCartesian(b),L[ee]=new t.Cartesian2(ne,ie),j[ee]=te,U[ee]=re,T&&(z[ee]=(d.WebMercatorProjection.geodeticLatitudeToMercatorAngle(b.latitude)-c)*u),f&&(q[ee]=k.geodeticSurfaceNormal(re)),a.Matrix4.multiplyByPoint(V,re,v),t.Cartesian3.minimumByComponent(v,Q,Q),t.Cartesian3.maximumByComponent(v,K,K)}var oe,ae=C(s.westIndices,(function(e,t){return L[e].y-L[t].y})),se=C(s.eastIndices,(function(e,t){return L[t].y-L[e].y})),de=C(s.southIndices,(function(e,t){return L[t].x-L[e].x})),he=C(s.northIndices,(function(e,t){return L[e].x-L[t].x}));F<0&&(oe=new n.EllipsoidalOccluder(k).computeHorizonCullingPointPossiblyUnderEllipsoid(_,U,F));var ce=Math.min(F,M(s.westIndices,s.westSkirtHeight,j,L,y,k,V,Q,K));ce=Math.min(ce,M(s.southIndices,s.southSkirtHeight,j,L,y,k,V,Q,K)),ce=Math.min(ce,M(s.eastIndices,s.eastSkirtHeight,j,L,y,k,V,Q,K)),ce=Math.min(ce,M(s.northIndices,s.northSkirtHeight,j,L,y,k,V,Q,K));for(var ue,Ie=new e.AxisAlignedBoundingBox(Q,K,_),le=new n.TerrainEncoding(_,Ie,ce,H,G,R,T,f,E,p),ge=le.stride,me=new Float32Array(I*ge+m*ge),Te=0,Ee=0;Ee<I;++Ee)R&&(S.x=l[ue=2*Ee],S.y=l[1+ue]),Te=le.encode(me,Te,U[Ee],L[Ee],j[Ee],S,z[Ee],q[Ee]);return Ie=Math.max(0,2*(m-4)),ce=s.indices.length+3*Ie,(G=i.IndexDatatype.createTypedArray(I+m,ce)).set(s.indices,0),Ie=E=1e-4*(Z-X),ce=-(m=p=1e-4*($-J)),x(me,p=I*ge,ae,le,j,L,l,k,y,s.westSkirtHeight,c,u,-E,0),x(me,p+=s.westIndices.length*ge,de,le,j,L,l,k,y,s.southSkirtHeight,c,u,0,ce),x(me,p+=s.southIndices.length*ge,se,le,j,L,l,k,y,s.eastSkirtHeight,c,u,Ie,0),x(me,p+=s.eastIndices.length*ge,he,le,j,L,l,k,y,s.northSkirtHeight,c,u,0,m),g.addSkirtIndices(ae,de,se,he,I,G,s.indices.length),h.push(me.buffer,G.buffer),{vertices:me.buffer,indices:G.buffer,westIndicesSouthToNorth:ae,southIndicesEastToWest:de,eastIndicesNorthToSouth:se,northIndicesWestToEast:he,vertexStride:ge,center:_,minimumHeight:F,maximumHeight:H,occludeePointInScaledSpace:oe,encoding:le,indexCountWithoutSkirts:s.indices.length}}))}));